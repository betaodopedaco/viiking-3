(function() {
  // Criar botÃ£o flutuante
  var btn = document.createElement('div');
  btn.style.position = 'fixed';
  btn.style.bottom = '20px';
  btn.style.right = '20px';
  btn.style.width = '60px';
  btn.style.height = '60px';
  btn.style.borderRadius = '50%';
  btn.style.background = '#d32f2f';
  btn.style.boxShadow = '0px 4px 8px rgba(0,0,0,0.2)';
  btn.style.cursor = 'pointer';
  btn.style.zIndex = '9999';
  btn.style.display = 'flex';
  btn.style.alignItems = 'center';
  btn.style.justifyContent = 'center';
  btn.style.fontSize = '28px';
  btn.innerHTML = 'ðŸ’¬';
  document.body.appendChild(btn);

  // Criar container do chat
  var chatContainer = document.createElement('div');
  chatContainer.id = 'chat-container';
  chatContainer.style.position = 'fixed';
  chatContainer.style.bottom = '90px';
  chatContainer.style.right = '20px';
  chatContainer.style.width = '400px';
  chatContainer.style.height = '500px';
  chatContainer.style.border = '1px solid #ccc';
  chatContainer.style.borderRadius = '12px';
  chatContainer.style.boxShadow = '0px 4px 12px rgba(0,0,0,0.3)';
  chatContainer.style.background = '#111';
  chatContainer.style.color = '#fff';
  chatContainer.style.display = 'none';
  chatContainer.style.flexDirection = 'column';
  chatContainer.style.overflow = 'hidden';
  chatContainer.style.zIndex = '9999';
  document.body.appendChild(chatContainer);

  // Criar Ã¡rea de mensagens
  var messages = document.createElement('div');
  messages.style.flex = '1';
  messages.style.overflowY = 'auto';
  messages.style.padding = '10px';
  chatContainer.appendChild(messages);

  // Criar input
  var input = document.createElement('input');
  input.id = 'chat-input';
  input.placeholder = 'Digite sua mensagem...';
  input.style.width = '100%';
  input.style.padding = '10px';
  input.style.borderRadius = '8px';
  input.style.border = 'none';
  input.style.background = '#222';
  input.style.color = '#fff';
  input.style.marginTop = 'auto';
  chatContainer.appendChild(input);

  // Mostrar/ocultar chat ao clicar no botÃ£o
  btn.addEventListener('click', function() {
    chatContainer.style.display = chatContainer.style.display === 'none' ? 'flex' : 'none';
    input.focus();
  });

  // FunÃ§Ã£o para adicionar mensagens na tela
  function addMessage(text, sender) {
    var msg = document.createElement('div');
    msg.textContent = text;
    msg.style.padding = '8px 12px';
    msg.style.borderRadius = '12px';
    msg.style.marginBottom = '6px';
    msg.style.maxWidth = '75%';
    msg.style.wordWrap = 'break-word';
    if(sender === 'user') {
      msg.style.background = '#b30000';
      msg.style.color = '#fff';
      msg.style.alignSelf = 'flex-end';
    } else {
      msg.style.background = '#222';
      msg.style.color = '#ddd';
      msg.style.alignSelf = 'flex-start';
    }
    messages.appendChild(msg);
    messages.scrollTop = messages.scrollHeight;
  }

  // Enviar mensagem ao pressionar Enter
  input.addEventListener('keypress', function(e) {
    if(e.key === 'Enter' && input.value.trim() !== '') {
      var message = input.value.trim();
      input.value = '';
      addMessage(message, 'user');

      fetch('https://viiking-3-6.onrender.com/chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({message: message, session_id: 'default'})
      })
      .then(response => response.json())
      .then(data => {
        var responseMessage = data.response || 'Sem resposta';
        addMessage(responseMessage, 'bot');
      })
      .catch(err => {
        console.error('Erro:', err);
        addMessage('Erro ao conectar com o servidor.', 'bot');
      });
    }
  });
})();
